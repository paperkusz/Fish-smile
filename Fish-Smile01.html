<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fish-Smile Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f8ff;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background-color: #1e88e5;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .header h1 {
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            color: #1e88e5;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .unit {
            font-size: 1rem;
            color: #7f8c8d;
        }
        
        .chart-container {
            height: 200px;
            margin-top: 15px;
            position: relative;
        }
        
        .status {
            display: flex;
            align-items: center;
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 20px;
            background-color: #f8f9fa;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .good {
            background-color: #2ecc71;
        }
        
        .warning {
            background-color: #f39c12;
        }
        
        .danger {
            background-color: #e74c3c;
        }
        
        .data-table-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .data-table th {
            background-color: #1e88e5;
            color: white;
            padding: 12px 15px;
            text-align: left;
        }
        
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .refresh-btn {
            background-color: #1e88e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.3s;
        }
        
        .refresh-btn:hover {
            background-color: #1565c0;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .value {
                font-size: 1.8rem;
            }
        }
        
        /* Loading spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1e88e5;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* AI Analysis Section */
        .analysis-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .analysis-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: #1e88e5;
        }
        
        .analysis-content {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            line-height: 1.7;
        }
        
        .analysis-good {
            border-left: 4px solid #2ecc71;
        }
        
        .analysis-warning {
            border-left: 4px solid #f39c12;
        }
        
        .analysis-danger {
            border-left: 4px solid #e74c3c;
        }
        
        .recommendation {
            margin-top: 15px;
            padding: 15px;
            background-color: #e3f2fd;
            border-radius: 8px;
            font-style: italic;
        }
        
        .notification-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .notification-container {
            position: relative;
        }
        
        /* Custom chart styles */
        .simple-chart {
            height: 100%;
            display: flex;
            align-items: flex-end;
            gap: 2px;
        }
        
        .chart-bar {
            flex: 1;
            background-color: #1e88e5;
            border-radius: 3px 3px 0 0;
            transition: height 0.5s ease;
        }
        
        .chart-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.7rem;
            color: #7f8c8d;
        }
        
        .back-button {
            display: inline-block;
            margin-bottom: 15px;
            padding: 8px 15px;
            background-color: #1e88e5;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .back-button:hover {
            background-color: #1565c0;
        }
        
        .forecast-chart-container {
            height: 250px;
            margin-top: 20px;
        }
        
        /* Pagination Styles */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .pagination-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .pagination-btn {
            padding: 8px 15px;
            background-color: #1e88e5;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background-color: #1565c0;
        }
        
        .pagination-btn:disabled {
            background-color: #b0bec5;
            cursor: not-allowed;
        }
        
        .page-info {
            margin: 0 15px;
            font-weight: 500;
        }
        
        .items-per-page {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .filter-controls input, .filter-controls select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .filter-btn {
            padding: 8px 15px;
            background-color: #1e88e5;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .filter-btn:hover {
            background-color: #1565c0;
        }
        
        .data-summary {
            margin-top: 15px;
            font-style: italic;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="https://paperkusz.github.io/Fish-smile/" class="back-button">
            <i class="fas fa-arrow-left"></i> ย้อนกลับ
        </a>
        
        <div class="header">
            <h1><i class="fas fa-fish"></i> บ่อปลาที่ 1 (ปลาทับทิม) </h1>
            <p>อุปกรณ์อัจฉริยะตรวจคุณภาพน้ำสำหรับการเลี้ยงปลาในบ่อปิดและแจ้งเตือนเมื่อคุณภาพน้ำเปลี่ยนไป</p>
        </div>
        
        <div class="loader" id="loader"></div>
        
        <div class="dashboard" id="dashboard">
            <div class="card">
                <h2><i class="fas fa-tint"></i> ค่า pH</h2>
                <div class="value" id="phValue">7.22 <span class="unit">pH</span></div>
                <div class="status">
                    <div class="status-indicator good"></div>
                    <span>อยู่ในเกณฑ์ปกติ (6.5-8.5)</span>
                </div>
                <div class="chart-container" id="phChart"></div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-water"></i> ค่า TDS</h2>
                <div class="value" id="tdsValue">167.9 <span class="unit">ppm</span></div>
                <div class="status">
                    <div class="status-indicator warning"></div>
                    <span>ควรระวัง (100-500 ppm)</span>
                </div>
                <div class="chart-container" id="tdsChart"></div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-cloud"></i> ความขุ่น</h2>
                <div class="value" id="turbidityValue">0 <span class="unit">NTU</span></div>
                <div class="status">
                    <div class="status-indicator good"></div>
                    <span>อยู่ในเกณฑ์ปกติ (0-10 NTU)</span>
                </div>
                <div class="chart-container" id="turbidityChart"></div>
            </div>
        </div>
        
        <!-- ส่วนวิเคราะห์ด้วย AI -->
        <div class="analysis-container" id="aiAnalysisContainer">
            <h2><i class="fas fa-brain"></i> การวิเคราะห์คุณภาพน้ำด้วย AI</h2>
            <div class="analysis-content analysis-warning">
                <p><strong>สถานะน้ำ:</strong> ต้องระวัง</p>
                <p><strong>อัปเดตล่าสุด:</strong> 24/8/2025, 19:38:29</p>
                <p><strong>ปัญหาที่พบ:</strong></p>
                <ul>
                    <li>ค่า TDS (167.9 ppm) อยู่ในเกณฑ์ที่ควรระวัง</li>
                    <li>ค่า pH (7.22) และความขุ่น (0 NTU) อยู่ในเกณฑ์ปกติ</li>
                </ul>
                
                <div class="forecast-chart-container">
                    <canvas id="forecastChart"></canvas>
                </div>
            </div>
            <div class="recommendation">
                <p><strong>คำแนะนำ:</strong></p>
                <ul>
                    <li>ควรตรวจสอบค่า TDS อย่างใกล้ชิด เนื่องจากมีแนวโน้มเพิ่มขึ้น</li>
                    <li>ติดตามการเปลี่ยนแปลงของค่า pH อย่างสม่ำเสมอ</li>
                    <li>ตรวจสอบระบบกรองน้ำเพื่อให้แน่ใจว่าทำงานได้อย่างมีประสิทธิภาพ</li>
                    <li>บันทึกข้อมูลอย่างต่อเนื่องเพื่อติดตามแนวโน้มการเปลี่ยนแปลง</li>
                </ul>
            </div>
        </div>
        
        <div class="data-table-container">
            <h2><i class="fas fa-history"></i> ข้อมูลย้อนหลัง</h2>
            
            <div class="filter-controls">
                <div>
                    <label for="dateFilter">วันที่:</label>
                    <input type="date" id="dateFilter">
                </div>
                <div>
                    <label for="parameterFilter">พารามิเตอร์:</label>
                    <select id="parameterFilter">
                        <option value="all">ทั้งหมด</option>
                        <option value="pH">ค่า pH</option>
                        <option value="tds">ค่า TDS</option>
                        <option value="turbidity">ความขุ่น</option>
                    </select>
                </div>
                <div>
                    <label for="statusFilter">สถานะ:</label>
                    <select id="statusFilter">
                        <option value="all">ทั้งหมด</option>
                        <option value="good">ปกติ</option>
                        <option value="warning">ควรระวัง</option>
                        <option value="danger">อันตราย</option>
                    </select>
                </div>
                <button class="filter-btn" onclick="applyFilters()">
                    <i class="fas fa-filter"></i> กรองข้อมูล
                </button>
                <button class="filter-btn" onclick="clearFilters()">
                    <i class="fas fa-times"></i> ล้างฟิลเตอร์
                </button>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>วันที่/เวลา</th>
                        <th>ค่า pH</th>
                        <th>ค่า TDS</th>
                        <th>ความขุ่น</th>
                        <th>สถานะ</th>
                    </tr>
                </thead>
                <tbody id="dataTableBody">
                    <!-- ข้อมูลจะถูกเพิ่มโดย JavaScript -->
                </tbody>
            </table>
            
            <div class="data-summary" id="dataSummary">
                กำลังแสดงข้อมูล 1-10 จาก 36 รายการ
            </div>
            
            <div class="pagination">
                <div class="pagination-controls">
                    <button class="pagination-btn" id="firstPageBtn" onclick="goToPage(1)" disabled>
                        <i class="fas fa-angle-double-left"></i>
                    </button>
                    <button class="pagination-btn" id="prevPageBtn" onclick="changePage(-1)" disabled>
                        <i class="fas fa-angle-left"></i> ก่อนหน้า
                    </button>
                    <span class="page-info" id="pageInfo">หน้า 1/4</span>
                    <button class="pagination-btn" id="nextPageBtn" onclick="changePage(1)">
                        ถัดไป <i class="fas fa-angle-right"></i>
                    </button>
                    <button class="pagination-btn" id="lastPageBtn" onclick="goToPage(4)">
                        <i class="fas fa-angle-double-right"></i>
                    </button>
                </div>
                
                <div>
                    <label for="itemsPerPage">แสดง:</label>
                    <select class="items-per-page" id="itemsPerPage" onchange="changeItemsPerPage()">
                        <option value="10">10 รายการ</option>
                        <option value="25">25 รายการ</option>
                        <option value="50">50 รายการ</option>
                        <option value="100">100 รายการ</option>
                    </select>
                </div>
            </div>
            
            <button class="refresh-btn" onclick="loadData()">
                <i class="fas fa-sync-alt"></i> โหลดข้อมูลใหม่
            </button>
        </div>
        
        <div class="footer">
            <p>Protpittayapayat School | © 2025</p>
        </div>
    </div>

    <script>
        // ข้อมูลตัวอย่างจากที่คุณให้มา
        const sampleData = [
            { timestamp: '23/8/2025, 12:25:43', pH: 7.24, tds: 253.2, turbidity: 12.3 },
            { timestamp: '23/8/2025, 13:16:53', pH: 7.21, tds: 258, turbidity: 12.3 },
            { timestamp: '23/8/2025, 13:17:20', pH: 7.23, tds: 269.3, turbidity: 11.6 },
            { timestamp: '23/8/2025, 13:17:49', pH: 7.26, tds: 258.1, turbidity: 11.4 },
            { timestamp: '23/8/2025, 13:18:25', pH: 7.24, tds: 256.5, turbidity: 11.8 },
            { timestamp: '23/8/2025, 13:18:53', pH: 7.23, tds: 253.5, turbidity: 11.2 },
            { timestamp: '23/8/2025, 13:19:20', pH: 7.23, tds: 253.2, turbidity: 11.2 },
            { timestamp: '23/8/2025, 13:19:47', pH: 7.24, tds: 260.6, turbidity: 11.4 },
            { timestamp: '23/8/2025, 13:20:15', pH: 7.27, tds: 238.9, turbidity: 11.6 },
            { timestamp: '23/8/2025, 13:20:43', pH: 7.23, tds: 243.2, turbidity: 11.9 },
            { timestamp: '23/8/2025, 13:21:10', pH: 7.21, tds: 252.2, turbidity: 12.3 },
            { timestamp: '23/8/2025, 13:21:37', pH: 7.24, tds: 245.4, turbidity: 12.2 },
            { timestamp: '23/8/2025, 13:22:05', pH: 7.23, tds: 256.2, turbidity: 12.3 },
            { timestamp: '23/8/2025, 13:22:32', pH: 7.23, tds: 251.4, turbidity: 12.4 },
            { timestamp: '23/8/2025, 13:22:59', pH: 7.26, tds: 253.3, turbidity: 12.2 },
            { timestamp: '23/8/2025, 13:23:27', pH: 7.25, tds: 251.2, turbidity: 12.2 },
            { timestamp: '23/8/2025, 13:23:54', pH: 7.24, tds: 249.6, turbidity: 11.8 },
            { timestamp: '23/8/2025, 13:24:21', pH: 7.23, tds: 252.4, turbidity: 11.9 },
            { timestamp: '23/8/2025, 13:24:51', pH: 7.24, tds: 254.9, turbidity: 11.9 },
            { timestamp: '23/8/2025, 13:25:48', pH: 7.24, tds: 247.6, turbidity: 12.1 },
            { timestamp: '23/8/2025, 13:26:16', pH: 7.25, tds: 246.2, turbidity: 12.2 },
            { timestamp: '23/8/2025, 13:26:45', pH: 7.27, tds: 248.3, turbidity: 12.2 },
            { timestamp: '23/8/2025, 13:27:14', pH: 7.26, tds: 251.6, turbidity: 11.9 },
            { timestamp: '23/8/2025, 13:27:41', pH: 7.24, tds: 253.9, turbidity: 11.2 },
            { timestamp: '23/8/2025, 13:28:13', pH: 7.24, tds: 253.9, turbidity: 11.4 },
            { timestamp: '23/8/2025, 13:28:41', pH: 7.26, tds: 248.5, turbidity: 11.6 },
            { timestamp: '23/8/2025, 13:29:11', pH: 7.23, tds: 251.3, turbidity: 11.5 },
            { timestamp: '23/8/2025, 13:29:39', pH: 7.24, tds: 256.2, turbidity: 11.2 },
            { timestamp: '23/8/2025, 13:30:06', pH: 7.25, tds: 247.7, turbidity: 11.4 },
            { timestamp: '23/8/2025, 13:30:49', pH: 7.23, tds: 251.9, turbidity: 11.8 },
            { timestamp: '23/8/2025, 13:31:17', pH: 7.25, tds: 248.6, turbidity: 11.8 },
            { timestamp: '23/8/2025, 13:31:45', pH: 7.24, tds: 258.1, turbidity: 11.9 },
            { timestamp: '23/8/2025, 13:32:12', pH: 7.26, tds: 254.5, turbidity: 12.4 },
            { timestamp: '23/8/2025, 13:32:52', pH: 7.24, tds: 257.3, turbidity: 12.2 },
            { timestamp: '23/8/2025, 13:33:20', pH: 7.22, tds: 265.6, turbidity: 12.2 },
            { timestamp: '23/8/2025, 13:33:47', pH: 3.9, tds: 118, turbidity: 0 },
            { timestamp: '23/8/2025, 13:34:14', pH: 4.23, tds: 115.2, turbidity: 0 },
            { timestamp: '23/8/2025, 13:34:41', pH: 4.12, tds: 119.5, turbidity: 0 },
            { timestamp: '23/8/2025, 13:35:08', pH: 4.24, tds: 119.1, turbidity: 0 },
            { timestamp: '23/8/2025, 13:35:44', pH: 4.09, tds: 120.9, turbidity: 0 },
            { timestamp: '23/8/2025, 13:36:11', pH: 6.55, tds: 119.5, turbidity: 0 },
            { timestamp: '23/8/2025, 13:36:42', pH: 7.37, tds: 125.9, turbidity: 0 },
            { timestamp: '23/8/2025, 13:37:11', pH: 7.37, tds: 111.6, turbidity: 0 },
            { timestamp: '23/8/2025, 13:37:38', pH: 6.43, tds: 129.8, turbidity: 0 },
            { timestamp: '23/8/2025, 13:38:05', pH: 7.37, tds: 126.2, turbidity: 0 },
            { timestamp: '23/8/2025, 13:38:33', pH: 7.37, tds: 125.9, turbidity: 0 },
            { timestamp: '23/8/2025, 13:39:01', pH: 7.37, tds: 128.4, turbidity: 0 },
            { timestamp: '23/8/2025, 13:39:30', pH: 7.37, tds: 123.4, turbidity: 0 },
            { timestamp: '23/8/2025, 13:39:57', pH: 7.37, tds: 125.5, turbidity: 0 },
            { timestamp: '23/8/2025, 13:40:25', pH: 7.37, tds: 125.2, turbidity: 0 },
            { timestamp: '23/8/2025, 13:40:52', pH: 6.48, tds: 127.7, turbidity: 0 },
            { timestamp: '23/8/2025, 13:41:19', pH: 7.37, tds: 127.7, turbidity: 0 },
            { timestamp: '23/8/2025, 13:41:47', pH: 7.37, tds: 125.5, turbidity: 0 },
            { timestamp: '23/8/2025, 13:42:16', pH: 7.37, tds: 125.5, turbidity: 0 },
            { timestamp: '23/8/2025, 13:42:43', pH: 7.17, tds: 126.2, turbidity: 0 },
            { timestamp: '23/8/2025, 13:43:11', pH: 7.37, tds: 124.8, turbidity: 0 },
            { timestamp: '23/8/2025, 13:43:38', pH: 6.51, tds: 128.4, turbidity: 0 },
            { timestamp: '23/8/2025, 13:44:06', pH: 7.37, tds: 126.9, turbidity: 0 },
            { timestamp: '23/8/2025, 13:44:33', pH: 7.37, tds: 127.7, turbidity: 0 },
            { timestamp: '23/8/2025, 13:45:02', pH: 6.56, tds: 129.8, turbidity: 0 },
            { timestamp: '23/8/2025, 13:45:31', pH: 7.37, tds: 126.2, turbidity: 0 },
            { timestamp: '23/8/2025, 13:45:58', pH: 6.44, tds: 127.7, turbidity: 0 },
            { timestamp: '23/8/2025, 13:46:26', pH: 7.37, tds: 114.1, turbidity: 0 },
            { timestamp: '23/8/2025, 13:46:54', pH: 6.89, tds: 126.6, turbidity: 0 },
            { timestamp: '23/8/2025, 13:47:55', pH: 7.37, tds: 125.2, turbidity: 0 },
            { timestamp: '23/8/2025, 13:48:22', pH: 7.37, tds: 125.9, turbidity: 0 },
            { timestamp: '23/8/2025, 13:48:50', pH: 6.44, tds: 130.9, turbidity: 0 },
            { timestamp: '23/8/2025, 13:49:19', pH: 7.37, tds: 130.9, turbidity: 0 },
            { timestamp: '23/8/2025, 13:49:45', pH: 6.65, tds: 131.2, turbidity: 0 },
            { timestamp: '23/8/2025, 13:50:13', pH: 7.37, tds: 135.1, turbidity: 0 },
            { timestamp: '23/8/2025, 13:50:40', pH: 7.37, tds: 130.9, turbidity: 0 },
            { timestamp: '23/8/2025, 13:51:17', pH: 7.34, tds: 126.9, turbidity: 0 },
            { timestamp: '23/8/2025, 13:51:44', pH: 7.37, tds: 131.2, turbidity: 0 },
            { timestamp: '23/8/2025, 13:52:11', pH: 7.37, tds: 116.2, turbidity: 0 },
            { timestamp: '23/8/2025, 13:52:39', pH: 7.37, tds: 128.4, turbidity: 0 },
            { timestamp: '23/8/2025, 13:53:07', pH: 6.65, tds: 127.3, turbidity: 0 },
            { timestamp: '23/8/2025, 13:53:34', pH: 7.37, tds: 126.2, turbidity: 0 },
            { timestamp: '23/8/2025, 13:54:02', pH: 7.37, tds: 119.8, turbidity: 0 },
            { timestamp: '23/8/2025, 13:54:30', pH: 6.42, tds: 130.9, turbidity: 0 },
            { timestamp: '23/8/2025, 13:54:57', pH: 7.37, tds: 128, turbidity: 0 },
            { timestamp: '23/8/2025, 13:55:29', pH: 7.37, tds: 128, turbidity: 0 },
            { timestamp: '23/8/2025, 13:56:41', pH: 6.51, tds: 131.6, turbidity: 0 },
            { timestamp: '23/8/2025, 13:57:09', pH: 7.37, tds: 131.6, turbidity: 0 },
            { timestamp: '23/8/2025, 13:57:38', pH: 7.37, tds: 126.9, turbidity: 0 },
            { timestamp: '23/8/2025, 13:58:06', pH: 6.62, tds: 117.7, turbidity: 0 },
            { timestamp: '23/8/2025, 13:58:37', pH: 7.37, tds: 129.4, turbidity: 0 },
            { timestamp: '23/8/2025, 13:59:09', pH: 7.37, tds: 116.6, turbidity: 0 },
            { timestamp: '23/8/2025, 14:00:17', pH: 6.29, tds: 130.9, turbidity: 5.3 },
            { timestamp: '23/8/2025, 14:29:44', pH: 7.37, tds: 143.7, turbidity: 5.3 },
            { timestamp: '23/8/2025, 14:59:22', pH: 7.37, tds: 140.5, turbidity: 5.3 },
            { timestamp: '23/8/2025, 15:29:04', pH: 7.26, tds: 136.9, turbidity: 5.3 },
            { timestamp: '23/8/2025, 15:58:42', pH: 7.37, tds: 136.9, turbidity: 5.3 },
            { timestamp: '23/8/2025, 16:28:22', pH: 7.37, tds: 139.8, turbidity: 5.3 },
            { timestamp: '23/8/2025, 16:58:01', pH: 7.37, tds: 134.8, turbidity: 5.3 },
            { timestamp: '23/8/2025, 17:27:40', pH: 7.37, tds: 128.7, turbidity: 5.3 },
            { timestamp: '23/8/2025, 17:57:19', pH: 7.37, tds: 136.9, turbidity: 5.3 },
            { timestamp: '23/8/2025, 18:27:02', pH: 7.03, tds: 136.6, turbidity: 5.3 },
            { timestamp: '23/8/2025, 18:56:39', pH: 7.37, tds: 136.9, turbidity: 5.3 },
            { timestamp: '23/8/2025, 19:26:20', pH: 7.37, tds: 139.8, turbidity: 5.3 },
            { timestamp: '23/8/2025, 19:56:00', pH: -2.73, tds: 133.7, turbidity: 5.3 },
            { timestamp: '23/8/2025, 20:25:39', pH: 7.37, tds: 136.6, turbidity: 5.3 },
            { timestamp: '23/8/2025, 20:55:19', pH: 7.37, tds: 138, turbidity: 5.3 },
            { timestamp: '23/8/2025, 21:24:52', pH: 7.37, tds: 136.9, turbidity: 5.3 },
            { timestamp: '23/8/2025, 21:54:26', pH: -0.49, tds: 133.7, turbidity: 5.3 },
            { timestamp: '23/8/2025, 22:24:07', pH: 7.37, tds: 138.7, turbidity: 5.3 },
            { timestamp: '23/8/2025, 22:53:48', pH: 7.37, tds: 141.9, turbidity: 5.3 },
            { timestamp: '23/8/2025, 23:23:28', pH: 7.37, tds: 141.6, turbidity: 5.3 },
            { timestamp: '23/8/2025, 23:53:09', pH: 7.37, tds: 138.4, turbidity: 5.3 },
            { timestamp: '24/8/2025, 0:22:46', pH: -1.33, tds: 127.3, turbidity: 5.3 },
            { timestamp: '24/8/2025, 0:52:26', pH: 0.13, tds: 144.8, turbidity: 5.3 },
            { timestamp: '24/8/2025, 1:22:09', pH: 7.37, tds: 129.4, turbidity: 5.3 },
            { timestamp: '24/8/2025, 1:51:48', pH: 7.37, tds: 126.6, turbidity: 5.3 },
            { timestamp: '24/8/2025, 2:21:27', pH: -1.94, tds: 143.3, turbidity: 5.3 },
            { timestamp: '24/8/2025, 2:51:07', pH: 7.37, tds: 143.7, turbidity: 5.3 },
            { timestamp: '24/8/2025, 3:20:47', pH: -1.98, tds: 145.8, turbidity: 5.3 },
            { timestamp: '24/8/2025, 3:50:28', pH: 7.37, tds: 146.6, turbidity: 5.3 },
            { timestamp: '24/8/2025, 4:20:09', pH: -1.54, tds: 148, turbidity: 5.3 },
            { timestamp: '24/8/2025, 4:49:49', pH: 7.37, tds: 149, turbidity: 5.3 },
            { timestamp: '24/8/2025, 5:19:26', pH: -1.36, tds: 150.1, turbidity: 5.3 },
            { timestamp: '24/8/2025, 5:49:05', pH: -0.22, tds: 147.6, turbidity: 5.3 },
            { timestamp: '24/8/2025, 6:18:45', pH: -0.94, tds: 149, turbidity: 5.3 },
            { timestamp: '24/8/2025, 6:48:26', pH: 3.96, tds: 153.7, turbidity: 5.3 },
            { timestamp: '24/8/2025, 7:47:51', pH: 7.37, tds: 122.3, turbidity: 5.3 },
            { timestamp: '24/8/2025, 8:17:30', pH: 7.37, tds: 154, turbidity: 5.3 },
            { timestamp: '24/8/2025, 8:47:08', pH: -1.69, tds: 153.7, turbidity: 5.3 },
            { timestamp: '24/8/2025, 9:16:46', pH: 6.73, tds: 153, turbidity: 5.3 },
            { timestamp: '24/8/2025, 9:46:23', pH: 2.39, tds: 152.3, turbidity: 5.3 },
            { timestamp: '24/8/2025, 10:16:03', pH: 1.23, tds: 138.4, turbidity: 5.3 },
            { timestamp: '24/8/2025, 10:45:46', pH: 6.87, tds: 154.8, turbidity: 5.3 },
            { timestamp: '24/8/2025, 11:15:21', pH: 7.15, tds: 160.5, turbidity: 5.3 },
            { timestamp: '24/8/2025, 11:45:01', pH: 1.93, tds: 148.7, turbidity: 5.3 },
            { timestamp: '24/8/2025, 12:14:43', pH: 0.62, tds: 150.5, turbidity: 5.3 },
            { timestamp: '24/8/2025, 12:44:21', pH: 6.86, tds: 154, turbidity: 5.3 },
            { timestamp: '24/8/2025, 13:13:59', pH: 7.37, tds: 150.8, turbidity: 5.3 },
            { timestamp: '24/8/2025, 13:43:38', pH: 7.37, tds: 152.3, turbidity: 5.3 },
            { timestamp: '24/8/2025, 14:13:18', pH: 7.37, tds: 158.7, turbidity: 5.3 },
            { timestamp: '24/8/2025, 15:12:37', pH: 7.37, tds: 154, turbidity: 5.3 },
            { timestamp: '24/8/2025, 16:11:57', pH: 7.02, tds: 154.4, turbidity: 5.3 },
            { timestamp: '24/8/2025, 16:41:37', pH: 7.37, tds: 159, turbidity: 5.3 },
            { timestamp: '24/8/2025, 17:11:16', pH: 7.25, tds: 160.8, turbidity: 5.3 },
            { timestamp: '24/8/2025, 17:40:54', pH: 7.37, tds: 161.2, turbidity: 5.3 },
            { timestamp: '24/8/2025, 18:10:33', pH: 7.37, tds: 157.3, turbidity: 5.3 },
            { timestamp: '24/8/2025, 18:40:13', pH: 7.3, tds: 159.4, turbidity: 5.3 },
            { timestamp: '24/8/2025, 19:09:49', pH: 7.22, tds: 136.9, turbidity: 5.3 },
            { timestamp: '24/8/2025, 19:19:48', pH: 7.08, tds: 172.9, turbidity: 5.3 },
            { timestamp: '24/8/2025, 19:36:35', pH: 7.37, tds: 157.6, turbidity: 5.3 },
            { timestamp: '24/8/2025, 19:38:29', pH: 7.22, tds: 167.9, turbidity: 0 }
        ];

        // ตัวแปรสำหรับการจัดการ pagination
        let currentPage = 1;
        let itemsPerPage = 10;
        let filteredData = [...sampleData];
        
        // ฟังก์ชันสำหรับโหลดข้อมูล
        function loadData() {
            // เรียงข้อมูลจากใหม่ไปเก่า
            const sortedData = [...sampleData].sort((a, b) => {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            filteredData = sortedData;
            
            // อัพเดทค่าปัจจุบัน
            updateCurrentValues(sortedData[0]);
            
            // อัพเดทกราฟ
            createCharts(sortedData);
            
            // สร้างกราฟพยากรณ์
            createForecastChart(sortedData);
            
            // อัพเดทตารางข้อมูล
            updateDataTable();
            
            // อัพเดทการวิเคราะห์ AI
            updateAIAnalysis(sortedData);
            
            // แสดงการแจ้งเตือนหากมีความขุ่นสูง
            if (sortedData[0].turbidity > 10) {
                showNotification(1);
            }
        }
        
        // อัพเดทค่าปัจจุบัน
        function updateCurrentValues(latestData) {
            document.getElementById('phValue').innerHTML = `${latestData.pH} <span class="unit">pH</span>`;
            document.getElementById('tdsValue').innerHTML = `${latestData.tds} <span class="unit">ppm</span>`;
            document.getElementById('turbidityValue').innerHTML = `${latestData.turbidity} <span class="unit">NTU</span>`;
            
            // อัพเดทสถานะ
            updateStatus('ph', latestData.pH);
            updateStatus('tds', latestData.tds);
            updateStatus('turbidity', latestData.turbidity);
        }
        
        // อัพเดทสถานะ
        function updateStatus(type, value) {
            let statusElement, indicator, text;
            
            if (type === 'ph') {
                statusElement = document.querySelector('#dashboard > div:nth-child(1) .status');
                indicator = statusElement.querySelector('.status-indicator');
                text = statusElement.querySelector('span');
                
                if (value >= 6.5 && value <= 8.5) {
                    indicator.className = 'status-indicator good';
                    text.textContent = 'อยู่ในเกณฑ์ปกติ (6.5-8.5)';
                } else {
                    indicator.className = 'status-indicator danger';
                    text.textContent = 'อยู่นอกเกณฑ์ปกติ (6.5-8.5)';
                }
            } else if (type === 'tds') {
                statusElement = document.querySelector('#dashboard > div:nth-child(2) .status');
                indicator = statusElement.querySelector('.status-indicator');
                text = statusElement.querySelector('span');
                
                if (value >= 100 && value <= 500) {
                    indicator.className = 'status-indicator good';
                    text.textContent = 'อยู่ในเกณฑ์ปกติ (100-500 ppm)';
                } else if (value >= 80 && value <= 600) {
                    indicator.className = 'status-indicator warning';
                    text.textContent = 'ควรระวัง (100-500 ppm)';
                } else {
                    indicator.className = 'status-indicator danger';
                    text.textContent = 'อยู่นอกเกณฑ์ปกติ (100-500 ppm)';
                }
            } else if (type === 'turbidity') {
                statusElement = document.querySelector('#dashboard > div:nth-child(3) .status');
                indicator = statusElement.querySelector('.status-indicator');
                text = statusElement.querySelector('span');
                
                if (value >= 0 && value <= 10) {
                    indicator.className = 'status-indicator good';
                    text.textContent = 'อยู่ในเกณฑ์ปกติ (0-10 NTU)';
                } else {
                    indicator.className = 'status-indicator danger';
                    text.textContent = 'อยู่นอกเกณฑ์ปกติ (0-10 NTU)';
                }
            }
        }
        
        // อัพเดทการวิเคราะห์ AI
        function updateAIAnalysis(data) {
            const latestData = data[0];
            const analysisContent = document.querySelector('.analysis-content');
            const analysisHeader = document.querySelector('.analysis-container h2');
            
            // กำหนดคลาสตามสถานะ
            if (latestData.turbidity > 10 || latestData.pH < 6.5 || latestData.pH > 8.5) {
                analysisContent.className = 'analysis-content analysis-danger';
            } else if (latestData.tds < 100 || latestData.tds > 500) {
                analysisContent.className = 'analysis-content analysis-warning';
            } else {
                analysisContent.className = 'analysis-content analysis-good';
            }
            
            // อัพเดทเนื้อหา
            let statusText, problems, recommendations;
            
            if (latestData.turbidity > 10) {
                statusText = "อันตราย";
                problems = `<ul>
                    <li>ค่าความขุ่น (${latestData.turbidity} NTU) สูงเกินเกณฑ์ (>10 NTU)</li>
                    <li>ค่า pH (${latestData.pH}) ${latestData.pH < 6.5 || latestData.pH > 8.5 ? 'อยู่นอกเกณฑ์ปกติ' : 'อยู่ในเกณฑ์ปกติ'}</li>
                    <li>ค่า TDS (${latestData.tds} ppm) ${latestData.tds < 100 || latestData.tds > 500 ? 'อยู่นอกเกณฑ์ปกติ' : 'อยู่ในเกณฑ์ปกติ'}</li>
                </ul>`;
                recommendations = `<ul>
                    <li>ควรตรวจสอบระบบกรองน้ำและทำความสะอาดทันที</li>
                    <li>พิจารณาใช้สารช่วยตกตะกอนเพื่อลดความขุ่น</li>
                    <li>ตรวจสอบแหล่งที่มาของความขุ่น เช่น อาหารปลาหรือสิ่งปฏิกูล</li>
                    <li>ติดตามค่า TDS อย่างใกล้ชิดเนื่องจากมีความผันผวน</li>
                </ul>`;
            } else if (latestData.pH < 6.5 || latestData.pH > 8.5) {
                statusText = "อันตราย";
                problems = `<ul>
                    <li>ค่า pH (${latestData.pH}) อยู่นอกเกณฑ์ปกติ (6.5-8.5)</li>
                    <li>ค่าความขุ่น (${latestData.turbidity} NTU) ${latestData.turbidity > 10 ? 'สูงเกินเกณฑ์' : 'อยู่ในเกณฑ์ปกติ'}</li>
                    <li>ค่า TDS (${latestData.tds} ppm) ${latestData.tds < 100 || latestData.tds > 500 ? 'อยู่นอกเกณฑ์ปกติ' : 'อยู่ในเกณฑ์ปกติ'}</li>
                </ul>`;
                recommendations = `<ul>
                    <li>ควรปรับค่า pH ให้อยู่ในเกณฑ์ที่เหมาะสม</li>
                    <li>ตรวจสอบแหล่งที่มาของการเปลี่ยนแปลงค่า pH</li>
                    <li>ติดตามค่าความขุ่นและค่า TDS อย่างใกล้ชิด</li>
                </ul>`;
            } else if (latestData.tds < 100 || latestData.tds > 500) {
                statusText = "ต้องระวัง";
                problems = `<ul>
                    <li>ค่า TDS (${latestData.tds} ppm) ${latestData.tds < 100 ? 'ต่ำกว่า' : 'สูงกว่า'} เกณฑ์ปกติ (100-500 ppm)</li>
                    <li>ค่า pH (${latestData.pH}) อยู่ในเกณฑ์ปกติ</li>
                    <li>ค่าความขุ่น (${latestData.turbidity} NTU) อยู่ในเกณฑ์ปกติ</li>
                </ul>`;
                recommendations = `<ul>
                    <li>ควรตรวจสอบค่า TDS อย่างใกล้ชิด เนื่องจากมีแนวโน้ม${latestData.tds < 100 ? 'ลดลง' : 'เพิ่มขึ้น'}</li>
                    <li>ติดตามการเปลี่ยนแปลงของค่า pH อย่างสม่ำเสมอ</li>
                    <li>ตรวจสอบระบบกรองน้ำเพื่อให้แน่ใจว่าทำงานได้อย่างมีประสิทธิภาพ</li>
                </ul>`;
            } else {
                statusText = "ปกติ";
                problems = `<ul>
                    <li>ค่า pH (${latestData.pH}) อยู่ในเกณฑ์ปกติ</li>
                    <li>ค่า TDS (${latestData.tds} ppm) อยู่ในเกณฑ์ปกติ</li>
                    <li>ค่าความขุ่น (${latestData.turbidity} NTU) อยู่ในเกณฑ์ปกติ</li>
                </ul>`;
                recommendations = `<ul>
                    <li>继续保持当前的水质管理措施</li>
                    <li>定期监测水质参数</li>
                    <li>记录数据以跟踪变化趋势</li>
                </ul>`;
            }
            
            analysisContent.innerHTML = `
                <p><strong>สถานะน้ำ:</strong> ${statusText}</p>
                <p><strong>อัปเดตล่าสุด:</strong> ${latestData.timestamp}</p>
                <p><strong>ปัญหาที่พบ:</strong></p>
                ${problems}
            `;
            
            document.querySelector('.recommendation').innerHTML = `
                <p><strong>คำแนะนำ:</strong></p>
                ${recommendations}
            `;
        }
        
        // ฟังก์ชันสำหรับอัพเดทตารางข้อมูล
        function updateDataTable() {
            const tableBody = document.getElementById('dataTableBody');
            const dataSummary = document.getElementById('dataSummary');
            const pageInfo = document.getElementById('pageInfo');
            
            // คำนวณข้อมูลสำหรับหน้าปัจจุบัน
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredData.length);
            const currentData = filteredData.slice(startIndex, endIndex);
            
            // ล้างตารางเดิม
            tableBody.innerHTML = '';
            
            // เพิ่มข้อมูลใหม่
            currentData.forEach(data => {
                const row = document.createElement('tr');
                
                // กำหนดสถานะ
                let status = '';
                let statusClass = '';
                
                if (data.turbidity > 10) {
                    status = 'ความขุ่นสูง';
                    statusClass = 'danger';
                } else if (data.pH < 6.5 || data.pH > 8.5) {
                    status = 'ค่า pH ผิดปกติ';
                    statusClass = 'danger';
                } else if (data.tds < 100 || data.tds > 500) {
                    status = 'ค่า TDS ผิดปกติ';
                    statusClass = 'warning';
                } else {
                    status = 'ปกติ';
                    statusClass = 'good';
                }
                
                row.innerHTML = `
                    <td>${data.timestamp}</td>
                    <td>${data.pH.toFixed(2)}</td>
                    <td>${data.tds.toFixed(1)}</td>
                    <td>${data.turbidity.toFixed(1)}</td>
                    <td><div class="status-indicator ${statusClass}"></div> ${status}</td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // อัพเดทข้อมูลสรุป
            dataSummary.textContent = `กำลังแสดงข้อมูล ${startIndex + 1}-${endIndex} จาก ${filteredData.length} รายการ`;
            
            // อัพเดทข้อมูลหน้า
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            pageInfo.textContent = `หน้า ${currentPage}/${totalPages}`;
            
            // อัพเดทสถานะปุ่ม pagination
            document.getElementById('firstPageBtn').disabled = currentPage === 1;
            document.getElementById('prevPageBtn').disabled = currentPage === 1;
            document.getElementById('nextPageBtn').disabled = currentPage === totalPages;
            document.getElementById('lastPageBtn').disabled = currentPage === totalPages;
        }
        
        // ฟังก์ชันเปลี่ยนหน้า
        function changePage(direction) {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                updateDataTable();
            }
        }
        
        // ฟังก์ชันไปที่หน้าเฉพาะ
        function goToPage(page) {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                updateDataTable();
            }
        }
        
        // ฟังก์ชันเปลี่ยนจำนวนรายการต่อหน้า
        function changeItemsPerPage() {
            itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
            currentPage = 1; // รีเซ็ตกลับไปหน้าที่ 1
            updateDataTable();
        }
        
        // ฟังก์ชันกรองข้อมูล
        function applyFilters() {
            const dateFilter = document.getElementById('dateFilter').value;
            const parameterFilter = document.getElementById('parameterFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            // กรองข้อมูลตามวันที่
            let newFilteredData = [...sampleData];
            
            if (dateFilter) {
                const filterDate = new Date(dateFilter);
                newFilteredData = newFilteredData.filter(data => {
                    const dataDate = new Date(data.timestamp);
                    return dataDate.toDateString() === filterDate.toDateString();
                });
            }
            
            // กรองข้อมูลตามพารามิเตอร์
            if (parameterFilter !== 'all') {
                if (parameterFilter === 'pH') {
                    newFilteredData = newFilteredData.filter(data => data.pH < 6.5 || data.pH > 8.5);
                } else if (parameterFilter === 'tds') {
                    newFilteredData = newFilteredData.filter(data => data.tds < 100 || data.tds > 500);
                } else if (parameterFilter === 'turbidity') {
                    newFilteredData = newFilteredData.filter(data => data.turbidity > 10);
                }
            }
            
            // กรองข้อมูลตามสถานะ
            if (statusFilter !== 'all') {
                newFilteredData = newFilteredData.filter(data => {
                    if (statusFilter === 'good') {
                        return data.turbidity <= 10 && data.pH >= 6.5 && data.pH <= 8.5 && data.tds >= 100 && data.tds <= 500;
                    } else if (statusFilter === 'warning') {
                        return (data.tds < 100 || data.tds > 500) && data.turbidity <= 10 && data.pH >= 6.5 && data.pH <= 8.5;
                    } else if (statusFilter === 'danger') {
                        return data.turbidity > 10 || data.pH < 6.5 || data.pH > 8.5;
                    }
                    return true;
                });
            }
            
            // เรียงข้อมูลจากใหม่ไปเก่า
            filteredData = newFilteredData.sort((a, b) => {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            // รีเซ็ตไปหน้าที่ 1
            currentPage = 1;
            
            // อัพเดทตาราง
            updateDataTable();
        }
        
        // ฟังก์ชันล้างฟิลเตอร์
        function clearFilters() {
            document.getElementById('dateFilter').value = '';
            document.getElementById('parameterFilter').value = 'all';
            document.getElementById('statusFilter').value = 'all';
            
            // คืนค่าข้อมูลทั้งหมด
            filteredData = [...sampleData].sort((a, b) => {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            // รีเซ็ตไปหน้าที่ 1
            currentPage = 1;
            
            // อัพเดทตาราง
            updateDataTable();
        }

        // สร้างกราฟสำหรับค่า pH, TDS และความขุ่น
        function createCharts(data) {
            // ใช้ข้อมูล 10 ตัวล่าสุด
            const recentData = data.slice(0, 10).reverse();
            
            // สร้างกราฟ pH
            createSimpleChart('phChart', recentData.map(d => d.pH), 'pH');
            
            // สร้างกราฟ TDS
            createSimpleChart('tdsChart', recentData.map(d => d.tds), 'TDS (ppm)');
            
            // สร้างกราฟความขุ่น
            createSimpleChart('turbidityChart', recentData.map(d => d.turbidity), 'ความขุ่น (NTU)');
        }

        // สร้างกราฟง่ายๆ
        function createSimpleChart(chartId, values, label) {
            const container = document.getElementById(chartId);
            container.innerHTML = '';
            
            const maxValue = Math.max(...values, 10); // อย่างน้อย 10 เพื่อให้กราฟไม่แบนเกินไป
            const chartHeight = 150; // ความสูงของกราฟ
            
            const chartWrapper = document.createElement('div');
            chartWrapper.className = 'simple-chart';
            
            // สร้างแท่งกราฟ
            values.forEach(value => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                const height = (value / maxValue) * chartHeight;
                bar.style.height = `${height}px`;
                bar.title = `${value}`;
                chartWrapper.appendChild(bar);
            });
            
            container.appendChild(chartWrapper);
            
            // สร้าง label ด้านล่าง
            const labels = document.createElement('div');
            labels.className = 'chart-labels';
            labels.innerHTML = `
                <span>${values.length > 0 ? 'ก่อนหน้า' : ''}</span>
                <span>${label}</span>
                <span>ล่าสุด</span>
            `;
            container.appendChild(labels);
        }

        // สร้างกราฟพยากรณ์
        function createForecastChart(data) {
            const ctx = document.getElementById('forecastChart').getContext('2d');
            
            // ใช้ข้อมูลความขุ่น 10 ตัวล่าสุด
            const turbidityData = data.slice(0, 10).map(d => d.turbidity).reverse();
            const timestamps = data.slice(0, 10).map(d => 
                new Date(d.timestamp).toLocaleTimeString('th-TH', {hour: '2-digit', minute: '2-digit'})
            ).reverse();
            
            // สร้างข้อมูลพยากรณ์ (ตัวอย่าง)
            const forecastData = [
                turbidityData[turbidityData.length-1],
                turbidityData[turbidityData.length-1] * 0.98,
                turbidityData[turbidityData.length-1] * 0.96,
                turbidityData[turbidityData.length-1] * 0.94,
                turbidityData[turbidityData.length-1] * 0.92
            ];
            
            const forecastTimestamps = [
                'ปัจจุบัน',
                '+30 นาที',
                '+1 ชั่วโมง',
                '+1.5 ชั่วโมง',
                '+2 ชั่วโมง'
            ];
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [...timestamps, ...forecastTimestamps.slice(1)],
                    datasets: [
                        {
                            label: 'ข้อมูลจริง',
                            data: [...turbidityData, ...Array(forecastData.length-1).fill(null)],
                            borderColor: '#1e88e5',
                            backgroundColor: 'rgba(30, 136, 229, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'การพยากรณ์',
                            data: [...Array(turbidityData.length).fill(null), ...forecastData],
                            borderColor: '#e53935',
                            backgroundColor: 'rgba(229, 57, 53, 0.1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'เกณฑ์ปลอดภัย',
                            data: Array(turbidityData.length + forecastData.length).fill(10),
                            borderColor: '#2ecc71',
                            backgroundColor: 'transparent',
                            borderWidth: 1,
                            borderDash: [3, 3]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'แนวโน้มความขุ่นและพยากรณ์ 2 ชั่วโมงข้างหน้า',
                            font: {
                                size: 14
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'ความขุ่น (NTU)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // แสดงการแจ้งเตือน
        function showNotification(count) {
            const header = document.querySelector('.header');
            
            // ลบการแจ้งเตือนเก่าถ้ามี
            const oldNotification = document.querySelector('.notification-container');
            if (oldNotification) {
                header.removeChild(oldNotification);
            }
            
            const notification = document.createElement('div');
            notification.className = 'notification-container';
            notification.innerHTML = `
                <i class="fas fa-bell" style="font-size: 1.5rem; color: #e74c3c;"></i>
                <div class="notification-badge">${count}</div>
            `;
            header.appendChild(notification);
        }

        // โหลดข้อมูลเมื่อหน้าเว็บโหลดเสร็จ
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            // อัพเดทข้อมูลทุก 5 นาที
            setInterval(loadData, 5 * 60 * 1000);
        });
    </script>
</body>
</html>
