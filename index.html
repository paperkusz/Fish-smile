<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Fish‚ÄëSmile | Pond Monitoring</title>
    <meta name="description" content="Fish‚ÄëSmile pond monitoring dashboards and API." />
    <style>
      :root {
        --bg: #ffffff;
        --text: #0f172a;
        --muted: #64748b;
        --border: #e5e7eb;
        --surface: #ffffff;
        --surface-2: #f8fafc;
        --brand: #0ea5e9;
        --good: #16a34a;
        --warning: #d97706;
        --critical: #dc2626;
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--text);
        background: var(--bg);
      }
      .container { max-width: 1280px; margin: 0 auto; padding: 32px 24px 40px; min-height: 100dvh; display: flex; flex-direction: column; }
      header { padding: 8px 0 12px; display: flex; align-items: center; justify-content: space-between; gap: 16px; }
      .brand { display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--text); }
      .logo { width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #22d3ee, #60a5fa); display: grid; place-items: center; color: #0b1320; font-weight: 800; box-shadow: 0 6px 20px rgba(34, 211, 238, 0.25); }
      .hero { padding: 8px 0; }
      .title { font-size: clamp(28px, 4vw, 40px); letter-spacing: -0.02em; margin: 0 0 8px; }
      .subtitle { color: var(--muted); margin: 0; line-height: 1.6; }

      .content { flex: 1; display: flex; flex-direction: column; justify-content: center; padding: 12px 0; }
      .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 24px; margin-top: 28px; }
      .card { grid-column: span 12; background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 22px; position: relative; box-shadow: 0 1px 2px rgba(15, 23, 42, 0.04); transition: box-shadow 180ms ease, transform 180ms ease; text-decoration: none; color: inherit; }
      .card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08); }
      @media (min-width: 700px) { .card { grid-column: span 6; } }
      @media (min-width: 1024px) { .card { grid-column: span 3; } }

      .card-header { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 10px; }
      .pond-id { font-weight: 700; font-size: 18px; letter-spacing: 0.02em; }
      .status { font-size: 12px; font-weight: 700; padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); text-transform: uppercase; letter-spacing: 0.06em; background: var(--surface-2); }
      .status.good { color: var(--good); background: #ecfdf5; border-color: #a7f3d0; }
      .status.warning { color: var(--warning); background: #fffbeb; border-color: #fde68a; }
      .status.critical { color: var(--critical); background: #fef2f2; border-color: #fecaca; }

      .meta { color: var(--muted); font-size: 13px; margin: 8px 0 2px; min-height: 38px; }
      .pill { padding: 6px 10px; border: 1px solid var(--border); border-radius: 999px; font-size: 12px; color: var(--muted); background: var(--surface-2); }
      .row { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-top: 8px; }

      footer { margin: 32px 0 8px; color: var(--muted); font-size: 13px; text-align: center; }
      .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
      .arrow { opacity: 0.6; }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <a class="brand" href="#" aria-label="Fish‚ÄëSmile">
          <div class="logo">üêü</div>
          <div>
            <div style="font-weight:800; font-size: 18px;">Fish‚ÄëSmile</div>
            <div style="color:var(--muted); font-size:12px;">Pond Monitoring</div>
          </div>
        </a>
        <div aria-hidden="true"></div>
      </header>

      <main class="content">
        <section class="hero">
          <h1 class="title">Monitor water quality with clarity.</h1>
          <p class="subtitle">Real‚Äëtime dashboards, status indicators, and simple forecasts across your ponds.</p>
        </section>

        <section id="grid" class="grid">
        <!-- Pond cards (full-card links) -->
        <a class="card" href="Fish-Smile01.html" data-pond="pond1">
          <div class="card-header">
            <div class="pond-id">Pond 01 ¬∑ Ruby Fish</div>
            <div class="status warning" id="status-pond1">Loading</div>
          </div>
          <div class="meta" id="meta-pond1">Fetching latest status‚Ä¶</div>
          <div class="row">
            <span class="pill" id="type-pond1">Ruby Fish</span>
            <span class="arrow" aria-hidden>‚Üí</span>
          </div>
        </a>

        <a class="card" href="Fish-Smile02.html" data-pond="pond2">
          <div class="card-header">
            <div class="pond-id">Pond 02 ¬∑ Tilapia</div>
            <div class="status critical" id="status-pond2">Loading</div>
          </div>
          <div class="meta" id="meta-pond2">Fetching latest status‚Ä¶</div>
          <div class="row">
            <span class="pill" id="type-pond2">Tilapia</span>
            <span class="arrow" aria-hidden>‚Üí</span>
          </div>
        </a>

        <a class="card" href="Fish-Smile03.html" data-pond="pond3">
          <div class="card-header">
            <div class="pond-id">Pond 03 ¬∑ Catfish</div>
            <div class="status good" id="status-pond3">Loading</div>
          </div>
          <div class="meta" id="meta-pond3">Fetching latest status‚Ä¶</div>
          <div class="row">
            <span class="pill" id="type-pond3">Catfish</span>
            <span class="arrow" aria-hidden>‚Üí</span>
          </div>
        </a>

        <a class="card" href="Fish-Smile04.html" data-pond="pond4">
          <div class="card-header">
            <div class="pond-id">Pond 04 ¬∑ Nursery</div>
            <div class="status warning" id="status-pond4">Loading</div>
          </div>
          <div class="meta" id="meta-pond4">Fetching latest status‚Ä¶</div>
          <div class="row">
            <span class="pill" id="type-pond4">Nursery</span>
            <span class="arrow" aria-hidden>‚Üí</span>
          </div>
        </a>
        </section>
      </main>

      <footer>
        <div>API: <code id="api-origin">auto</code> ‚Ä¢ Status updates every 30s</div>
      </footer>
    </div>

    <script>
      (function () {
        const preferRelative = true; // use Nginx proxy if available
        const relative = '/api/ponds';
        const absolute = 'http://localhost:5050/api/ponds';

        const setAPIOriginText = (url) => {
          const el = document.getElementById('api-origin');
          if (el) el.textContent = url;
        };

        async function fetchPonds() {
          // Try relative first, then absolute fallback
          try {
            if (preferRelative) {
              setAPIOriginText('relative /api');
              const r = await fetch(relative, { cache: 'no-store' });
              if (!r.ok) throw new Error('relative failed');
              return await r.json();
            }
          } catch (_) {
            // fall through
          }
          setAPIOriginText(absolute);
          const r = await fetch(absolute, { cache: 'no-store' });
          if (!r.ok) throw new Error('API error: ' + r.status);
          return await r.json();
        }

        function badgeClass(status) {
          const s = String(status || '').toLowerCase();
          if (s.includes('good')) return 'good';
          if (s.includes('critical') || s.includes('danger')) return 'critical';
          return 'warning';
        }

        function fmtTime(ts) {
          try {
            return new Date(ts).toLocaleString();
          } catch { return ts || ''; }
        }

        function updateUI(payload) {
          if (!payload || !payload.ponds) return;
          payload.ponds.forEach(p => {
            const id = p.id; // pond1..4
            const st = document.getElementById('status-' + id);
            const meta = document.getElementById('meta-' + id);
            const type = document.getElementById('type-' + id);
            if (st) {
              st.textContent = (p.status || 'unknown').toUpperCase();
              st.className = 'status ' + badgeClass(p.status);
            }
            if (type) type.textContent = p.fish_type || '';
            if (meta) {
              const r = p.latest_reading || {};
              meta.textContent = `pH ${r.pH ?? '‚Äì'} ¬∑ TDS ${r.tds ?? '‚Äì'} ¬∑ NTU ${r.turbidity ?? '‚Äì'} ¬∑ ${fmtTime(r.timestamp)}`;
            }
          });
        }

        async function tick() {
          try {
            const data = await fetchPonds();
            updateUI(data);
          } catch (err) {
            console.warn('Failed to fetch ponds', err);
          }
        }

        tick();
        setInterval(tick, 30_000);
      })();
    </script>
  </body>
  </html>
